import React, { useState, useEffect, useCallback } from 'react';
import {
    Dialog,
    DialogTitle,
    DialogContent,
    DialogActions,
    Typography,
    Box,
    IconButton,
    Button,
    CircularProgress,
    Alert,
    Grid,
    TextField,
    Fab,
    Tooltip,
    Paper,
    InputAdornment,
    FormControl,
    InputLabel,
    Select,
    MenuItem,
    Chip,
    OutlinedInput,
    FormControlLabel,
    Switch,
    Divider
} from '@mui/material';
import { 
    Close, 
    Schedule, 
    Add, 
    Refresh,
    Search,
    Save,
    Cancel,
    Person,
    Groups
} from '@mui/icons-material';
import { useTheme } from '@mui/material/styles';
import { 
    getScheduledAssignments,
    getAllUsers,
    createScheduledAssignment,
    updateScheduledAssignment,
    cancelScheduledAssignment
} from '../../services/assignmentService';
import ScheduledAssignmentsList from './ScheduledAssignmentsList';

const ScheduledAssignmentsSimple = ({ open, onClose, teachers = [] }) => {
    const theme = useTheme();
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');
    const [scheduledAssignments, setScheduledAssignments] = useState([]);
    const [searchTerm, setSearchTerm] = useState('');
    const [selectedAssignment, setSelectedAssignment] = useState(null);
    const [showDetailDialog, setShowDetailDialog] = useState(false);
    const [showCreateDialog, setShowCreateDialog] = useState(false);
    const [showDeleteDialog, setShowDeleteDialog] = useState(false);
    const [assignmentToDelete, setAssignmentToDelete] = useState(null);
    const [isRefreshing, setIsRefreshing] = useState(false);
    const [newAssignment, setNewAssignment] = useState({
        title: '',
        description: '',
        publishDate: '',
        dueDate: '',
        closeDate: '',
        status: 'scheduled'
    });
    const [selectedTeachers, setSelectedTeachers] = useState([]);
    const [sendToAll, setSendToAll] = useState(false);
    const [isCreating, setIsCreating] = useState(false);
    const [teachersList, setTeachersList] = useState([]);

    useEffect(() => {
        console.log('üîÑ useEffect triggered - Dialog estado:', open);
        console.log('üë• Teachers prop length:', teachers.length);
        console.log('üìã Teachers prop:', teachers);
        
        // Verificar token de autenticaci√≥n
        const token = localStorage.getItem('token');
        console.log('üîê Token de autenticaci√≥n:', token ? 'Disponible' : 'No disponible');
        if (token) {
            console.log('üîê Token preview:', token.substring(0, 20) + '...');
        } else {
            console.warn('‚ö†Ô∏è NO HAY TOKEN - Las peticiones al backend fallar√°n');
        }
        
        if (open) {
            // Limpiar datos temporales al abrir
            const validAssignments = scheduledAssignments.filter(assignment => {
                const hasValidId = assignment._id && !assignment._id.toString().startsWith('temp_');
                if (!hasValidId) {
                    console.log('üßπ Limpiando dato temporal al abrir:', assignment._id, assignment.title);
                }
                return hasValidId;
            });
            
            if (validAssignments.length !== scheduledAssignments.length) {
                setScheduledAssignments(validAssignments);
                console.log('‚úÖ Datos temporales eliminados al abrir. Asignaciones v√°lidas restantes:', validAssignments.length);
            }
            
            loadScheduledAssignments();
            
            // PRIMERA PRIORIDAD: Si tenemos docentes en las props, usarlos inmediatamente
            if (teachers.length > 0) {
                console.log('‚úÖ Usando docentes de props inmediatamente...');
                setTeachersList(teachers);
            } else {
                console.log('‚ö†Ô∏è No hay docentes en props, intentando cargar desde API...');
                loadTeachers();
            }
        }
    }, [open, teachers, scheduledAssignments, loadTeachers, loadScheduledAssignments]);

    // useEffect separado para actualizar teachersList cuando cambien las props teachers
    useEffect(() => {
        console.log('üîÑ Teachers props cambiaron - Actualizando lista');
        console.log('üë• Nuevos teachers:', teachers.length, 'docentes');
        
        if (teachers.length > 0) {
            console.log('‚úÖ Actualizando teachersList con nuevos props...');
            setTeachersList(teachers);
        }
    }, [teachers]);

    const loadTeachers = useCallback(async () => {
        try {
            console.log('üîÑ Iniciando carga de docentes...');
            const response = await getAllUsers();
            console.log('üì• Respuesta de getAllUsers:', response);
            
            if (response.success) {
                console.log('‚úÖ Usuarios recibidos:', response.users?.length || 0);
                console.log('üë• Usuarios completos:', response.users);
                
                // Filtrar solo docentes (por ahora mostrar todos los usuarios para debug)
                const teachersOnly = response.users.filter(user => {
                    console.log('üîç Usuario encontrado:', user);
                    // Por ahora, considerar todos los usuarios como potenciales docentes
                    // excepto los que claramente son administradores
                    const isAdmin = user.email?.includes('admin') || 
                                  user.numeroControl?.startsWith('ADMIN') ||
                                  user.nombre?.toLowerCase().includes('admin');
                    
                    if (isAdmin) {
                        console.log('üö´ Usuario admin excluido:', user.nombre);
                        return false;
                    }
                    
                    console.log('‚úÖ Usuario incluido como docente:', user.nombre);
                    return true;
                });
                
                console.log('üë®‚Äçüè´ Docentes filtrados:', teachersOnly);
                console.log('ÔøΩ Total de docentes encontrados:', teachersOnly.length);
                
                setTeachersList(teachersOnly);
            } else {
                console.log('‚ùå Response no exitosa:', response);
                // Usar los docentes que se pasaron como prop
                setTeachersList(teachers);
            }
        } catch (error) {
            console.error('‚ùå Error al cargar docentes:', error);
            // Usar los docentes que se pasaron como prop
            setTeachersList(teachers);
        }
    }, [teachers]);

    const loadScheduledAssignments = useCallback(async () => {
        try {
            setLoading(true);
            setError('');
            setIsRefreshing(true);
            console.log('üîÑ Cargando asignaciones programadas...');
            
            const response = await getScheduledAssignments();
            console.log('üì• Respuesta completa recibida:', response);
            console.log('üìä Estructura de datos:', {
                success: response.success,
                hasData: !!response.data,
                assignments: response.data?.assignments?.length || 0,
                pagination: response.data?.pagination
            });
            
            if (response.success && response.data) {
                const assignments = response.data.assignments || [];
                console.log('üì¶ Asignaciones recibidas del servidor:', assignments.length);
                
                // Mostrar todas las asignaciones recibidas para debug
                assignments.forEach((assignment, index) => {
                    console.log(`üìã Asignaci√≥n ${index + 1}:`, {
                        id: assignment._id,
                        title: assignment.title,
                        status: assignment.status,
                        scheduledPublish: assignment.scheduledPublish
                    });
                });
                
                // Filtrar solo asignaciones con IDs v√°lidos de la base de datos (no temporales)
                const validAssignments = assignments.filter(assignment => {
                    const hasValidId = assignment._id && !assignment._id.toString().startsWith('temp_');
                    console.log(`üîç Validando asignaci√≥n "${assignment.title}":`, {
                        id: assignment._id,
                        esValido: hasValidId,
                        razon: hasValidId ? 'ID v√°lido' : 'ID temporal o faltante'
                    });
                    if (!hasValidId) {
                        console.log('üóëÔ∏è Asignaci√≥n temporal filtrada:', assignment._id);
                    }
                    return hasValidId;
                });
                
                setScheduledAssignments(validAssignments);
                console.log('‚úÖ Asignaciones programadas cargadas y filtradas:', validAssignments.length);
                console.log('üìä Comparaci√≥n:', {
                    recibidas: assignments.length,
                    filtradas: validAssignments.length,
                    eliminadas: assignments.length - validAssignments.length
                });
                
                if (validAssignments.length > 0) {
                    console.log('üìã Asignaciones v√°lidas guardadas en estado:', validAssignments.slice(0, 3).map(a => ({
                        id: a._id,
                        title: a.title,
                        status: a.status,
                        publishDate: a.publishDate
                    })));
                } else {
                    console.log('‚ö†Ô∏è No hay asignaciones programadas v√°lidas despu√©s del filtrado');
                    console.log('üîç Asignaciones originales que fueron filtradas:');
                    assignments.forEach(a => {
                        console.log(`   - ${a.title} (ID: ${a._id})`);
                    });
                }
            } else {
                console.log('‚ùå Respuesta no exitosa:', response);
                throw new Error(response.error || 'Error desconocido');
            }
        } catch (error) {
            console.error('‚ùå Error cargando asignaciones programadas:', error);
            setError('Error cargando asignaciones programadas: ' + (error.message || 'Error desconocido'));
        } finally {
            setLoading(false);
            setIsRefreshing(false);
        }
    }, []);

    const handleRefresh = () => {
        console.log('üîÑ Refrescando datos - eliminando datos temporales...');
        
        // Limpiar datos temporales antes de recargar
        const validAssignments = scheduledAssignments.filter(assignment => {
            const hasValidId = assignment._id && !assignment._id.toString().startsWith('temp_');
            if (!hasValidId) {
                console.log('üßπ Eliminando dato temporal durante refresh:', assignment._id, assignment.title);
            }
            return hasValidId;
        });
        
        if (validAssignments.length !== scheduledAssignments.length) {
            setScheduledAssignments(validAssignments);
            console.log('‚úÖ Datos temporales eliminados durante refresh');
        }
        
        // Recargar desde servidor
        loadScheduledAssignments();
    };

    const handleViewDetails = (assignment) => {
        console.log('üëÅÔ∏è Ver detalles de asignaci√≥n:', assignment);
        setSelectedAssignment(assignment);
        setShowDetailDialog(true);
        console.log('üîÑ Estado del dialog despu√©s de abrir:', {
            showDetailDialog: true,
            selectedAssignment: assignment
        });
    };

    const handleEditAssignment = (assignment) => {
        console.log('‚úèÔ∏è Editar asignaci√≥n:', assignment);
        
        // Rellenar el formulario con los datos de la asignaci√≥n
        setNewAssignment({
            title: assignment.title || '',
            description: assignment.description || '',
            publishDate: dateToInputFormat(assignment.publishDate),
            dueDate: dateToInputFormat(assignment.dueDate),
            closeDate: dateToInputFormat(assignment.closeDate),
            status: assignment.status || 'scheduled'
        });
        
        // Configurar docentes asignados
        if (assignment.assignToAll) {
            console.log('üìß Asignaci√≥n configurada para TODOS los docentes');
            setSendToAll(true);
            setSelectedTeachers([]);
        } else if (assignment.assignedTo && assignment.assignedTo.length > 0) {
            console.log('üë• Docentes asignados encontrados:', assignment.assignedTo.length);
            // Extraer IDs de los docentes asignados
            const teacherIds = assignment.assignedTo.map(teacher => 
                typeof teacher === 'string' ? teacher : teacher._id
            );
            console.log('üîç IDs de docentes a seleccionar:', teacherIds);
            setSendToAll(false);
            setSelectedTeachers(teacherIds);
        } else {
            console.log('‚ö†Ô∏è No se encontraron docentes asignados');
            setSendToAll(false);
            setSelectedTeachers([]);
        }
        
        setSelectedAssignment(assignment);
        setShowCreateDialog(true);
        
        console.log('üîÑ Estado del dialog de edici√≥n despu√©s de abrir:', {
            showCreateDialog: true,
            selectedAssignment: assignment,
            sendToAll: assignment.assignToAll || false,
            selectedTeachers: assignment.assignedTo || [],
            newAssignment: {
                title: assignment.title || '',
                description: assignment.description || '',
                publishDate: dateToInputFormat(assignment.publishDate),
                dueDate: dateToInputFormat(assignment.dueDate),
                closeDate: dateToInputFormat(assignment.closeDate),
                status: assignment.status || 'scheduled'
            }
        });
    };

    const handleDeleteAssignment = (assignment) => {
        setAssignmentToDelete(assignment);
        setShowDeleteDialog(true);
    };

    const confirmDeleteAssignment = async () => {
        if (assignmentToDelete) {
            try {
                // Verificar que sea una asignaci√≥n real (no temporal)
                if (assignmentToDelete._id && assignmentToDelete._id.toString().startsWith('temp_')) {
                    console.log('üö´ Intentando eliminar dato temporal - solo se remover√° localmente');
                    // Solo remover localmente datos temporales
                    const updatedAssignments = scheduledAssignments.filter(a => a._id !== assignmentToDelete._id);
                    setScheduledAssignments(updatedAssignments);
                } else {
                    // Eliminar asignaci√≥n real del servidor
                    console.log('üóëÔ∏è Eliminando asignaci√≥n real del servidor:', assignmentToDelete._id);
                    const response = await cancelScheduledAssignment(assignmentToDelete._id);
                    
                    if (response.success) {
                        console.log('‚úÖ Asignaci√≥n eliminada del servidor exitosamente');
                        // Recargar datos desde el servidor para mantener consistencia
                        await loadScheduledAssignments();
                    } else {
                        throw new Error(response.error || 'Error al eliminar asignaci√≥n');
                    }
                }
                
                console.log('üóëÔ∏è Asignaci√≥n eliminada:', assignmentToDelete.title);
                
            } catch (error) {
                console.error('‚ùå Error eliminando asignaci√≥n:', error);
                setError('Error eliminando asignaci√≥n: ' + error.message);
            } finally {
                // Cerrar dialog y limpiar estado
                setShowDeleteDialog(false);
                setAssignmentToDelete(null);
            }
        }
    };

    const handleCreateNew = () => {
        console.log('‚ûï Abriendo formulario de nueva asignaci√≥n');
        console.log('üë• Estado actual de teachersList:', teachersList.length, 'docentes');
        console.log('üìã Lista completa de docentes:', teachersList);
        
        setSelectedAssignment(null);
        setNewAssignment({
            title: '',
            description: '',
            publishDate: '',
            dueDate: '',
            closeDate: '',
            status: 'scheduled'
        });
        setShowCreateDialog(true);
    };

    const handleCreateAssignment = async () => {
        try {
            setIsCreating(true);
            
            // Debug de autenticaci√≥n
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            console.log('üîê Estado de autenticaci√≥n al crear asignaci√≥n:', {
                tieneToken: !!token,
                longitudToken: token ? token.length : 0,
                usuario: user.nombre || 'Sin usuario',
                email: user.email || 'Sin email',
                rol: user.role || 'Sin rol'
            });
            
            if (!token) {
                throw new Error('No hay token de autenticaci√≥n. Por favor, inicia sesi√≥n nuevamente.');
            }
            
            // Validar campos obligatorios
            if (!newAssignment.title || !newAssignment.description || !newAssignment.publishDate) {
                throw new Error('T√≠tulo, descripci√≥n y fecha de publicaci√≥n son obligatorios');
            }

            // Validar selecci√≥n de docentes
            if (!sendToAll && selectedTeachers.length === 0) {
                throw new Error('Debes seleccionar al menos un docente o marcar "Enviar a todos"');
            }

            const isEditing = selectedAssignment && selectedAssignment._id;
            
            // Determinar docentes asignados
            const assignedTeachers = sendToAll ? teachersList.map(t => t._id) : selectedTeachers;

            if (isEditing) {
                // Actualizar asignaci√≥n existente en el servidor
                try {
                    const updateData = {
                        title: newAssignment.title,
                        description: newAssignment.description,
                        dueDate: inputDateToISO(newAssignment.dueDate),
                        closeDate: inputDateToISO(newAssignment.closeDate),
                        publishDate: inputDateToISO(newAssignment.publishDate),
                        assignedTo: assignedTeachers,
                        assignToAll: sendToAll,
                        priority: 'normal',
                        reminderEnabled: true,
                        reminderDays: 1
                    };
                    
                    console.log('‚ú® Actualizando asignaci√≥n programada:', {
                        id: selectedAssignment._id,
                        titulo: updateData.title,
                        docentes: assignedTeachers.length,
                        enviarATodos: sendToAll,
                        fechasConvertidas: {
                            publishDate: updateData.publishDate,
                            dueDate: updateData.dueDate,
                            closeDate: updateData.closeDate
                        },
                        fechasOriginales: {
                            publishDate: newAssignment.publishDate,
                            dueDate: newAssignment.dueDate,
                            closeDate: newAssignment.closeDate
                        }
                    });
                    
                    const response = await updateScheduledAssignment(selectedAssignment._id, updateData);
                    console.log('üì• Respuesta de actualizaci√≥n:', response);
                    
                    if (response.success) {
                        console.log('‚úÖ Asignaci√≥n programada actualizada exitosamente en el servidor');
                        console.log('üìù ID de asignaci√≥n actualizada:', selectedAssignment._id);
                        // Recargar asignaciones desde el servidor
                        await loadScheduledAssignments();
                    } else {
                        console.log('‚ùå Error en respuesta del servidor:', response);
                        throw new Error(response.error || 'Error al actualizar asignaci√≥n programada');
                    }
                } catch (apiError) {
                    console.log('‚ùå Error con API al actualizar:', apiError);
                    console.log('‚ùå Detalles del error:', {
                        message: apiError.message,
                        response: apiError.response?.data,
                        status: apiError.response?.status,
                        stack: apiError.stack
                    });
                    
                    // Manejo m√°s espec√≠fico de errores 
                    if (apiError.message === 'Failed to fetch' || apiError.name === 'TypeError') {
                        throw new Error('No se pudo conectar con el servidor. Verifica que el backend est√© funcionando.');
                    } else if (apiError.response?.status === 401) {
                        throw new Error('Sesi√≥n expirada. Por favor, inicia sesi√≥n nuevamente.');
                    } else if (apiError.response?.status === 403) {
                        throw new Error('No tienes permisos para realizar esta acci√≥n.');
                    } else if (apiError.response?.data?.error) {
                        throw new Error(apiError.response.data.error);
                    } else {
                        throw new Error(`Error al actualizar asignaci√≥n: ${apiError.message || 'Error desconocido'}`);
                    }
                }
            } else {
                // Crear nueva asignaci√≥n programada
                try {
                    const assignmentData = {
                        title: newAssignment.title,
                        description: newAssignment.description,
                        dueDate: inputDateToISO(newAssignment.dueDate),
                        closeDate: inputDateToISO(newAssignment.closeDate),
                        publishDate: inputDateToISO(newAssignment.publishDate),
                        assignedTo: assignedTeachers,
                        assignToAll: sendToAll,
                        priority: 'normal',
                        reminderEnabled: true,
                        reminderDays: 1
                    };
                    
                    console.log('‚ú® Creando asignaci√≥n programada:', {
                        titulo: assignmentData.title,
                        docentes: assignedTeachers.length,
                        enviarATodos: sendToAll,
                        fechaPublicacion: assignmentData.publishDate,
                        fechaVencimiento: assignmentData.dueDate,
                        fechaCierre: assignmentData.closeDate,
                        fechasOriginales: {
                            publishDate: newAssignment.publishDate,
                            dueDate: newAssignment.dueDate,
                            closeDate: newAssignment.closeDate
                        }
                    });
                    
                    const response = await createScheduledAssignment(assignmentData);
                    console.log('üì• Respuesta de creaci√≥n:', response);
                    
                    if (response.success) {
                        console.log('‚úÖ Asignaci√≥n programada creada exitosamente en el servidor');
                        console.log('üìù ID de asignaci√≥n creada:', response.data?.assignment?._id);
                        // Recargar asignaciones desde el servidor
                        await loadScheduledAssignments();
                    } else {
                        console.log('‚ùå Error en respuesta del servidor:', response);
                        throw new Error(response.error || 'Error al crear asignaci√≥n programada');
                    }
                } catch (apiError) {
                    console.log('‚ùå Error con API al crear:', apiError);
                    console.log('‚ùå Detalles del error:', {
                        message: apiError.message,
                        response: apiError.response?.data,
                        status: apiError.response?.status,
                        stack: apiError.stack
                    });
                    
                    // Manejo m√°s espec√≠fico de errores
                    if (apiError.message === 'Failed to fetch' || apiError.name === 'TypeError') {
                        throw new Error('No se pudo conectar con el servidor. Verifica que el backend est√© funcionando.');
                    } else if (apiError.response?.status === 401) {
                        throw new Error('Sesi√≥n expirada. Por favor, inicia sesi√≥n nuevamente.');
                    } else if (apiError.response?.status === 403) {
                        throw new Error('No tienes permisos para realizar esta acci√≥n.');
                    } else if (apiError.response?.data?.error) {
                        throw new Error(apiError.response.data.error);
                    } else {
                        throw new Error(`Error al crear asignaci√≥n: ${apiError.message || 'Error desconocido'}`);
                    }
                }
            }

            // Comportamiento diferente seg√∫n si es creaci√≥n o actualizaci√≥n
            if (isEditing) {
                // Solo cerrar el di√°logo al actualizar, mantener los datos
                setShowCreateDialog(false);
                setSelectedAssignment(null);
                console.log('‚úÖ Asignaci√≥n actualizada - manteniendo datos del formulario');
            } else {
                // Limpiar formulario solo al crear nueva asignaci√≥n
                setShowCreateDialog(false);
                setSelectedAssignment(null);
                resetForm();
                console.log('‚úÖ Nueva asignaci√≥n creada - formulario limpiado');
            }

        } catch (error) {
            console.error('‚ùå Error procesando asignaci√≥n:', error);
            setError('Error procesando asignaci√≥n: ' + error.message);
        } finally {
            setIsCreating(false);
        }
    };

    const handleInputChange = (field, value) => {
        setNewAssignment(prev => ({
            ...prev,
            [field]: value
        }));
    };

    const handleTeachersChange = (event) => {
        const value = event.target.value;
        setSelectedTeachers(typeof value === 'string' ? value.split(',') : value);
    };

    const handleSendToAllChange = (event) => {
        setSendToAll(event.target.checked);
        if (event.target.checked) {
            setSelectedTeachers([]);
        }
    };

    const resetForm = () => {
        setNewAssignment({
            title: '',
            description: '',
            publishDate: '',
            dueDate: '',
            closeDate: '',
            status: 'scheduled'
        });
        setSelectedTeachers([]);
        setSendToAll(false);
    };

    const formatDate = (dateString) => {
        if (!dateString) return 'Sin fecha';
        
        // Crear fecha considerando que viene del servidor (posiblemente UTC)
        const date = new Date(dateString);
        
        // Verificar si la fecha es v√°lida
        if (isNaN(date.getTime())) {
            console.warn('Fecha inv√°lida recibida:', dateString);
            return 'Fecha inv√°lida';
        }
        
        // Formatear usando la zona horaria local
        return date.toLocaleDateString('es-ES', {
            day: '2-digit',
            month: 'long',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            timeZone: 'America/Mexico_City' // Especificar zona horaria de M√©xico
        });
    };
    
    // Funci√≥n para convertir fecha del servidor al formato datetime-local
    const dateToInputFormat = (dateString) => {
        if (!dateString) return '';
        
        const date = new Date(dateString);
        
        // Verificar si la fecha es v√°lida
        if (isNaN(date.getTime())) {
            console.warn('Fecha inv√°lida para input:', dateString);
            return '';
        }
        
        // Convertir a formato datetime-local (YYYY-MM-DDTHH:mm)
        // Usar la hora local del navegador para mantener consistencia
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        
        const formattedDate = `${year}-${month}-${day}T${hours}:${minutes}`;
        console.log('Fecha convertida para input:', dateString, '->', formattedDate);
        
        return formattedDate;
    };
    
    // Funci√≥n para convertir fecha del input al formato ISO para el servidor
    const inputDateToISO = (inputDateString) => {
        if (!inputDateString) return null;
        
        // El input datetime-local devuelve formato YYYY-MM-DDTHH:mm
        // Necesitamos convertirlo a ISO con zona horaria
        const date = new Date(inputDateString);
        
        if (isNaN(date.getTime())) {
            console.warn('Fecha inv√°lida del input:', inputDateString);
            return null;
        }
        
        // Convertir a ISO string manteniendo la hora local
        const isoString = date.toISOString();
        console.log('Fecha convertida para servidor:', inputDateString, '->', isoString);
        
        return isoString;
    };

    const getStatusLabel = (status) => {
        const statusMap = {
            'scheduled': 'Programada',
            'active': 'Activa',
            'draft': 'Borrador',
            'completed': 'Completada',
            'cancelled': 'Cancelada'
        };
        return statusMap[status] || status;
    };

    const getStatusColor = (status) => {
        const colorMap = {
            'scheduled': 'primary',
            'active': 'success',
            'draft': 'warning',
            'completed': 'info',
            'cancelled': 'error'
        };
        return colorMap[status] || 'default';
    };

    console.log('üé≠ Estados de los dialogs:', {
        showDetailDialog,
        showCreateDialog,
        showDeleteDialog,
        selectedAssignment: selectedAssignment ? selectedAssignment.title : null
    });

    const filteredAssignments = scheduledAssignments.filter(assignment =>
        assignment.title?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        assignment.description?.toLowerCase().includes(searchTerm.toLowerCase())
    );

    return (
        <>
            <Dialog
                open={open}
                onClose={onClose}
                maxWidth="lg"
                fullWidth
                PaperProps={{
                    sx: {
                        borderRadius: 3,
                        background: `linear-gradient(135deg, ${theme.palette.background.paper} 0%, ${theme.palette.grey[50]} 100%)`,
                        minHeight: '80vh',
                        boxShadow: theme.shadows[10]
                    }
                }}
            >
                <Box>
                    <DialogTitle sx={{ 
                        py: 2,
                        px: 3,
                        background: `linear-gradient(135deg, ${theme.palette.primary.dark} 0%, ${theme.palette.primary.main} 50%, ${theme.palette.secondary.main} 100%)`,
                        color: 'white',
                        display: 'flex',
                        justifyContent: 'space-between',
                        alignItems: 'center'
                    }}>
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
                            <Schedule sx={{ fontSize: 28 }} />
                            <Typography variant="h5" sx={{ fontWeight: 'bold' }}>
                                Asignaciones Programadas
                            </Typography>
                        </Box>
                        <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                            <Tooltip title="Actualizar">
                                <Box>
                                    <IconButton
                                        onClick={handleRefresh}
                                        disabled={isRefreshing}
                                        sx={{ color: 'white' }}
                                    >
                                        <Refresh sx={{ fontSize: 20 }} />
                                    </IconButton>
                                </Box>
                            </Tooltip>
                            <IconButton onClick={onClose} sx={{ color: 'white' }}>
                                <Close />
                            </IconButton>
                        </Box>
                    </DialogTitle>

                    <DialogContent sx={{ p: 3 }}>
                        <Box>
                            <Grid container spacing={2} alignItems="center">
                                <Grid item xs={12} md={9}>
                                    <TextField
                                        fullWidth
                                        placeholder="Buscar asignaciones programadas..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        InputProps={{
                                            startAdornment: (
                                                <InputAdornment position="start">
                                                    <Search color="action" />
                                                </InputAdornment>
                                            ),
                                        }}
                                        sx={{
                                            '& .MuiOutlinedInput-root': {
                                                borderRadius: 2,
                                                backgroundColor: 'white',
                                                boxShadow: theme.shadows[1]
                                            }
                                        }}
                                    />
                                </Grid>
                                <Grid item xs={12} md={3}>
                                    <Paper 
                                        elevation={2}
                                        sx={{ 
                                            p: 1.5, 
                                            textAlign: 'center',
                                            background: `linear-gradient(135deg, ${theme.palette.primary.main} 0%, ${theme.palette.primary.dark} 100%)`,
                                            color: 'white',
                                            borderRadius: 2
                                        }}
                                    >
                                        <Typography variant="h4" sx={{ fontWeight: 'bold', mb: 0.5 }}>
                                            {filteredAssignments.length}
                                        </Typography>
                                        <Typography variant="body2" sx={{ opacity: 0.9 }}>
                                            de {scheduledAssignments.length} asignaciones
                                        </Typography>
                                    </Paper>
                                </Grid>
                            </Grid>
                        </Box>

                        <Box sx={{ mt: 3 }}>
                            {loading ? (
                                <Box display="flex" justifyContent="center" alignItems="center" minHeight="200px">
                                    <CircularProgress size={40} />
                                </Box>
                            ) : error ? (
                                <Alert severity="error" sx={{ borderRadius: 2 }}>
                                    {error}
                                </Alert>
                            ) : filteredAssignments.length === 0 ? (
                                <Paper sx={{ p: 4, textAlign: 'center', borderRadius: 2, backgroundColor: theme.palette.grey[50] }}>
                                    <Typography variant="h6" color="text.secondary" gutterBottom sx={{ fontWeight: 'bold' }}>
                                        {searchTerm ? 'No se encontraron asignaciones' : 'No hay asignaciones programadas'}
                                    </Typography>
                                    <Typography variant="body2" color="text.secondary" sx={{ mb: 2 }}>
                                        {searchTerm 
                                            ? 'Intenta con otros t√©rminos de b√∫squeda o revisa la ortograf√≠a' 
                                            : 'Crea tu primera asignaci√≥n programada haciendo clic en el bot√≥n + en la esquina inferior derecha'
                                        }
                                    </Typography>
                                </Paper>
                            ) : (
                                <ScheduledAssignmentsList
                                    filteredAssignments={filteredAssignments}
                                    teachers={teachers}
                                    theme={theme}
                                    getStatusLabel={getStatusLabel}
                                    getStatusColor={getStatusColor}
                                    formatDate={formatDate}
                                    handleViewDetails={handleViewDetails}
                                    handleEditAssignment={handleEditAssignment}
                                    handleDeleteAssignment={handleDeleteAssignment}
                                />
                            )}
                        </Box>
                    </DialogContent>
                </Box>

                {/* Bot√≥n flotante para crear nueva asignaci√≥n */}
                <Box
                    sx={{
                        position: 'fixed',
                        bottom: 24,
                        right: 24,
                        zIndex: 1300
                    }}
                >
                    <Tooltip title="Crear Nueva Asignaci√≥n" placement="left">
                        <Fab
                            color="primary"
                            size="large"
                            onClick={handleCreateNew}
                            sx={{
                                background: `linear-gradient(135deg, ${theme.palette.primary.main} 0%, ${theme.palette.primary.dark} 100%)`,
                                '&:hover': {
                                    background: `linear-gradient(135deg, ${theme.palette.primary.dark} 0%, ${theme.palette.primary.main} 100%)`,
                                    transform: 'scale(1.1)',
                                    boxShadow: theme.shadows[8]
                                },
                                transition: 'all 0.3s ease',
                                boxShadow: theme.shadows[6]
                            }}
                        >
                            <Add fontSize="large" />
                        </Fab>
                    </Tooltip>
                </Box>
            </Dialog>

            {/* Dialog para crear/editar asignaci√≥n */}
            <Dialog
                open={showCreateDialog}
                onClose={() => {
                    setShowCreateDialog(false);
                    resetForm();
                }}
                maxWidth="lg"
                fullWidth
                PaperProps={{
                    sx: {
                        borderRadius: 3,
                        background: `linear-gradient(135deg, ${theme.palette.background.paper} 0%, ${theme.palette.grey[50]} 100%)`,
                        boxShadow: theme.shadows[10],
                        minHeight: '700px',
                        maxHeight: '90vh'
                    }
                }}
            >
                <DialogTitle sx={{ 
                    py: 3,
                    px: 4,
                    background: `linear-gradient(135deg, ${theme.palette.primary.dark} 0%, ${theme.palette.primary.main} 100%)`,
                    color: 'white',
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center'
                }}>
                    <Typography variant="h5" sx={{ fontWeight: 'bold' }}>
                        {selectedAssignment && selectedAssignment._id ? 'Editar Asignaci√≥n Programada' : 'Nueva Asignaci√≥n Programada'}
                    </Typography>
                    <IconButton 
                        onClick={() => {
                            setShowCreateDialog(false);
                            resetForm();
                        }}
                        sx={{ color: 'white' }}
                    >
                        <Close />
                    </IconButton>
                </DialogTitle>
                <DialogContent sx={{ p: 0, backgroundColor: 'transparent' }}>
                    <Box sx={{ 
                        backgroundColor: 'white', 
                        m: 4,
                        borderRadius: 3, 
                        p: 3,
                        boxShadow: theme.shadows[3],
                        border: `1px solid ${theme.palette.divider}`
                    }}>
                        {/* Informaci√≥n B√°sica */}
                        <Typography variant="h6" sx={{ mb: 3, color: theme.palette.primary.main, fontWeight: 'bold' }}>
                            Informaci√≥n B√°sica
                        </Typography>
                        
                        <Box sx={{ mb: 3 }}>
                            <TextField
                                fullWidth
                                label="T√≠tulo de la Asignaci√≥n"
                                value={newAssignment.title}
                                onChange={(e) => handleInputChange('title', e.target.value)}
                                variant="outlined"
                                required
                                sx={{ 
                                    '& .MuiInputBase-root': {
                                        height: '56px',
                                        fontSize: '1rem'
                                    }
                                }}
                            />
                        </Box>
                        
                        <Box sx={{ mb: 4 }}>
                            <TextField
                                fullWidth
                                label="Descripci√≥n Detallada"
                                value={newAssignment.description}
                                onChange={(e) => handleInputChange('description', e.target.value)}
                                variant="outlined"
                                multiline
                                rows={4}
                                required
                                sx={{ 
                                    '& .MuiInputBase-root': {
                                        fontSize: '1rem'
                                    }
                                }}
                            />
                        </Box>

                        {/* Fechas y Configuraci√≥n */}
                        <Typography variant="h6" sx={{ mb: 3, color: theme.palette.primary.main, fontWeight: 'bold' }}>
                            Fechas y Configuraci√≥n
                        </Typography>
                        
                        <Box sx={{ mb: 3 }}>
                            <TextField
                                fullWidth
                                label="Fecha de Publicaci√≥n"
                                type="datetime-local"
                                value={newAssignment.publishDate}
                                onChange={(e) => handleInputChange('publishDate', e.target.value)}
                                InputLabelProps={{ shrink: true }}
                                required
                                sx={{ 
                                    '& .MuiInputBase-root': {
                                        height: '56px',
                                        fontSize: '1rem'
                                    }
                                }}
                            />
                        </Box>
                        
                        <Box sx={{ mb: 3 }}>
                            <TextField
                                fullWidth
                                label="Fecha de Entrega"
                                type="datetime-local"
                                value={newAssignment.dueDate}
                                onChange={(e) => handleInputChange('dueDate', e.target.value)}
                                InputLabelProps={{ shrink: true }}
                                sx={{ 
                                    '& .MuiInputBase-root': {
                                        height: '56px',
                                        fontSize: '1rem'
                                    }
                                }}
                            />
                        </Box>
                        
                        <Box sx={{ mb: 3 }}>
                            <TextField
                                fullWidth
                                label="Fecha de Cierre"
                                type="datetime-local"
                                value={newAssignment.closeDate}
                                onChange={(e) => handleInputChange('closeDate', e.target.value)}
                                InputLabelProps={{ shrink: true }}
                                sx={{ 
                                    '& .MuiInputBase-root': {
                                        height: '56px',
                                        fontSize: '1rem'
                                    }
                                }}
                            />
                        </Box>
                        
                        <Box sx={{ mb: 3 }}>
                            <FormControl fullWidth>
                                <InputLabel>Estado de la Asignaci√≥n</InputLabel>
                                <Select
                                    value={newAssignment.status}
                                    onChange={(e) => handleInputChange('status', e.target.value)}
                                    label="Estado de la Asignaci√≥n"
                                    sx={{ 
                                        height: '56px'
                                    }}
                                >
                                    <MenuItem value="scheduled">üìÖ Programada</MenuItem>
                                    <MenuItem value="draft">üìù Borrador</MenuItem>
                                    <MenuItem value="active">‚úÖ Activa</MenuItem>
                                </Select>
                            </FormControl>
                        </Box>

                        {/* Asignaci√≥n de Docentes */}
                        <Divider sx={{ my: 4 }}>
                            <Typography variant="h6" sx={{ px: 2, color: theme.palette.primary.main, fontWeight: 'bold' }}>
                                üë• Asignaci√≥n de Docentes
                            </Typography>
                        </Divider>

                        {/* Switch para enviar a todos los docentes */}
                        <Box sx={{ mb: 3 }}>
                            <FormControlLabel
                                control={
                                    <Switch
                                        checked={sendToAll}
                                        onChange={handleSendToAllChange}
                                        color="primary"
                                        size="medium"
                                    />
                                }
                                label={
                                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                        <Groups sx={{ color: theme.palette.primary.main }} />
                                        <Typography variant="body1" sx={{ fontWeight: 'medium' }}>
                                            Enviar a todos los docentes
                                        </Typography>
                                    </Box>
                                }
                                sx={{ 
                                    mb: 2,
                                    '& .MuiFormControlLabel-label': {
                                        fontSize: '1rem'
                                    }
                                }}
                            />
                        </Box>

                        {/* Selector de docentes espec√≠ficos (solo si no se env√≠a a todos) */}
                        {!sendToAll && (
                            <Box sx={{ mb: 3 }}>
                                <FormControl fullWidth>
                                    <InputLabel id="teachers-select-label" sx={{ 
                                        display: 'flex', 
                                        alignItems: 'center', 
                                        gap: 1,
                                        fontSize: '1rem'
                                    }}>
                                        <Person sx={{ fontSize: '1rem' }} />
                                        Seleccionar Docentes Espec√≠ficos ({teachersList.length} disponibles)
                                    </InputLabel>
                                    <Select
                                        labelId="teachers-select-label"
                                        id="teachers-select"
                                        multiple
                                        value={selectedTeachers}
                                        onChange={handleTeachersChange}
                                        input={<OutlinedInput label="Seleccionar Docentes Espec√≠ficos" />}
                                        renderValue={(selected) => (
                                            <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 0.5 }}>
                                                {selected.map((teacherId) => {
                                                    const teacher = teachersList.find(t => t._id === teacherId);
                                                    return (
                                                        <Chip 
                                                            key={teacherId} 
                                                            label={teacher ? `${teacher.nombre} ${teacher.apellidoPaterno}` : teacherId}
                                                            size="small"
                                                            color="primary"
                                                            variant="outlined"
                                                            sx={{ 
                                                                fontSize: '0.875rem',
                                                                height: '24px'
                                                            }}
                                                        />
                                                    );
                                                })}
                                            </Box>
                                        )}
                                        sx={{ 
                                            minHeight: '56px',
                                            '& .MuiSelect-select': {
                                                fontSize: '1rem'
                                            }
                                        }}
                                    >
                                        {teachersList.length === 0 ? (
                                            <MenuItem disabled>
                                                <Typography variant="body2" color="text.secondary">
                                                    No hay docentes disponibles
                                                </Typography>
                                            </MenuItem>
                                        ) : (
                                            teachersList.map((teacher) => (
                                                <MenuItem key={teacher._id} value={teacher._id}>
                                                    <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                                        <Person fontSize="small" color="primary" />
                                                        <Box>
                                                            <Typography variant="body2" sx={{ fontWeight: 'medium' }}>
                                                                {teacher.nombre} {teacher.apellidoPaterno} {teacher.apellidoMaterno}
                                                            </Typography>
                                                            {teacher.email && (
                                                                <Typography variant="caption" color="text.secondary">
                                                                    {teacher.email}
                                                                </Typography>
                                                            )}
                                                        </Box>
                                                    </Box>
                                                </MenuItem>
                                            ))
                                        )}
                                    </Select>
                                    {!sendToAll && selectedTeachers.length === 0 && (
                                        <Typography variant="caption" color="error" sx={{ mt: 1, ml: 1 }}>
                                            Por favor selecciona al menos un docente o activa "Enviar a todos"
                                        </Typography>
                                    )}
                                </FormControl>
                            </Box>
                        )}

                        {/* Panel de resumen */}
                        <Box sx={{ 
                            mb: 4,
                            p: 3, 
                            borderRadius: 3, 
                            backgroundColor: theme.palette.grey[50],
                            border: `2px solid ${theme.palette.primary.light}`,
                            background: `linear-gradient(135deg, ${theme.palette.primary.light}10 0%, ${theme.palette.secondary.light}10 100%)`
                        }}>
                            <Typography variant="body1" color="text.secondary" gutterBottom sx={{ fontWeight: 'bold' }}>
                                üìã Resumen de Asignaci√≥n:
                            </Typography>
                            {sendToAll ? (
                                <Typography variant="body1" sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                    <Groups color="primary" />
                                    Se enviar√° a <strong>todos los docentes</strong> ({teachersList.length} docentes)
                                </Typography>
                            ) : (
                                <Typography variant="body1" sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                                    <Person color="primary" />
                                    Se enviar√° a <strong>{selectedTeachers.length}</strong> docente(s) seleccionado(s)
                                </Typography>
                            )}
                        </Box>

                        {/* Informaci√≥n adicional si est√° editando */}
                        {selectedAssignment && selectedAssignment._id && (
                            <Box sx={{ mt: 4 }}>
                                <Paper sx={{ 
                                    p: 3, 
                                    backgroundColor: theme.palette.info.light + '20',
                                    border: `2px solid ${theme.palette.info.light}`,
                                    borderRadius: 2
                                }}>
                                    <Typography variant="h6" sx={{ mb: 2, color: theme.palette.info.dark }}>
                                        üìä Informaci√≥n de la Asignaci√≥n Actual
                                    </Typography>
                                    <Box sx={{ display: 'flex', flexDirection: 'column', gap: 1 }}>
                                        <Typography variant="body2" color="text.secondary">
                                            <strong>T√≠tulo Original:</strong> {selectedAssignment.title}
                                        </Typography>
                                        <Typography variant="body2" color="text.secondary">
                                            <strong>Estado Actual:</strong> {getStatusLabel(selectedAssignment.status)}
                                        </Typography>
                                    </Box>
                                </Paper>
                            </Box>
                        )}
                    </Box>
                </DialogContent>
                <DialogActions sx={{ 
                    p: 4,
                    borderTop: `2px solid ${theme.palette.divider}`,
                    gap: 3,
                    justifyContent: 'space-between',
                    backgroundColor: 'white'
                }}>
                    <Typography variant="body2" color="text.secondary" sx={{ fontStyle: 'italic' }}>
                        Los campos marcados con * son obligatorios
                    </Typography>
                    <Box sx={{ display: 'flex', gap: 2 }}>
                        <Button
                            onClick={() => {
                                setShowCreateDialog(false);
                                resetForm();
                            }}
                            variant="outlined"
                            startIcon={<Cancel />}
                            sx={{ 
                                borderRadius: 3,
                                textTransform: 'none',
                                fontSize: '1rem',
                                minWidth: '150px',
                                height: '50px',
                                px: 4,
                                borderColor: theme.palette.grey[400],
                                color: theme.palette.grey[700],
                                '&:hover': {
                                    borderColor: theme.palette.grey[600],
                                    backgroundColor: theme.palette.grey[50],
                                    transform: 'translateY(-1px)'
                                }
                            }}
                        >
                            Cancelar
                        </Button>
                        <Button
                            onClick={handleCreateAssignment}
                            variant="contained"
                            startIcon={isCreating ? <CircularProgress size={18} color="inherit" /> : <Save />}
                            disabled={
                                isCreating ||
                                !newAssignment.title || 
                                !newAssignment.description || 
                                !newAssignment.publishDate ||
                                (!sendToAll && selectedTeachers.length === 0)
                            }
                            sx={{ 
                                borderRadius: 3,
                                textTransform: 'none',
                                fontSize: '1rem',
                                minWidth: '180px',
                                height: '50px',
                                px: 4,
                                background: `linear-gradient(135deg, ${theme.palette.primary.main} 0%, ${theme.palette.primary.dark} 100%)`,
                                '&:hover': {
                                    background: `linear-gradient(135deg, ${theme.palette.primary.dark} 0%, ${theme.palette.primary.main} 100%)`,
                                    transform: 'translateY(-2px)',
                                    boxShadow: theme.shadows[8]
                                },
                                '&:disabled': {
                                    background: theme.palette.grey[300],
                                    color: theme.palette.grey[500]
                                }
                            }}
                        >
                            {isCreating 
                                ? '‚è≥ Creando...' 
                                : (selectedAssignment && selectedAssignment._id ? 'üíæ Actualizar Asignaci√≥n' : '‚ú® Crear Asignaci√≥n')
                            }
                        </Button>
                    </Box>
                </DialogActions>
            </Dialog>

            {/* Dialog de confirmaci√≥n de eliminaci√≥n */}
            <Dialog
                open={showDeleteDialog}
                onClose={() => setShowDeleteDialog(false)}
                maxWidth="sm"
                fullWidth
                PaperProps={{
                    sx: {
                        borderRadius: 3,
                        boxShadow: theme.shadows[10]
                    }
                }}
            >
                <DialogTitle sx={{ 
                    py: 2,
                    px: 3,
                    background: `linear-gradient(135deg, ${theme.palette.error.dark} 0%, ${theme.palette.error.main} 100%)`,
                    color: 'white',
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center'
                }}>
                    <Typography variant="h6" sx={{ fontWeight: 'bold' }}>
                        Confirmar Eliminaci√≥n
                    </Typography>
                    <IconButton 
                        onClick={() => setShowDeleteDialog(false)}
                        sx={{ color: 'white' }}
                    >
                        <Close />
                    </IconButton>
                </DialogTitle>
                <DialogContent sx={{ p: 3 }}>
                    <Typography variant="body1" sx={{ mb: 2 }}>
                        ¬øEst√°s seguro de que quieres eliminar la siguiente asignaci√≥n?
                    </Typography>
                    {assignmentToDelete && (
                        <Box sx={{ 
                            p: 2, 
                            backgroundColor: theme.palette.grey[100], 
                            borderRadius: 2,
                            border: `1px solid ${theme.palette.error.light}`
                        }}>
                            <Typography variant="subtitle1" sx={{ fontWeight: 'bold', color: theme.palette.error.dark }}>
                                {assignmentToDelete.title}
                            </Typography>
                            <Typography variant="body2" color="text.secondary">
                                {assignmentToDelete.description}
                            </Typography>
                        </Box>
                    )}
                    <Typography variant="body2" color="error" sx={{ mt: 2, fontWeight: 'medium' }}>
                        Esta acci√≥n no se puede deshacer.
                    </Typography>
                </DialogContent>
                <DialogActions sx={{ 
                    p: 3,
                    borderTop: `1px solid ${theme.palette.divider}`,
                    gap: 2,
                    justifyContent: 'flex-end'
                }}>
                    <Button
                        onClick={() => setShowDeleteDialog(false)}
                        variant="outlined"
                        sx={{ 
                            borderRadius: 2,
                            textTransform: 'none',
                            fontSize: '1rem',
                            minWidth: '120px',
                            height: '48px',
                            px: 3
                        }}
                    >
                        Cancelar
                    </Button>
                    <Button
                        onClick={confirmDeleteAssignment}
                        variant="contained"
                        color="error"
                        sx={{ 
                            borderRadius: 2,
                            textTransform: 'none',
                            fontSize: '1rem',
                            minWidth: '120px',
                            height: '48px',
                            px: 3,
                            '&:hover': {
                                transform: 'translateY(-1px)',
                                boxShadow: theme.shadows[6]
                            }
                        }}
                    >
                        Eliminar
                    </Button>
                </DialogActions>
            </Dialog>

            {/* Dialog para ver detalles */}
            <Dialog
                open={showDetailDialog}
                onClose={() => setShowDetailDialog(false)}
                maxWidth="md"
                fullWidth
                PaperProps={{
                    sx: {
                        borderRadius: 3,
                        boxShadow: theme.shadows[10]
                    }
                }}
            >
                <DialogTitle sx={{ 
                    py: 2,
                    px: 3,
                    background: `linear-gradient(135deg, ${theme.palette.primary.dark} 0%, ${theme.palette.primary.main} 100%)`,
                    color: 'white',
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center'
                }}>
                    <Typography variant="h6" sx={{ fontWeight: 'bold' }}>
                        Detalles de la Asignaci√≥n
                    </Typography>
                    <IconButton 
                        onClick={() => setShowDetailDialog(false)}
                        sx={{ color: 'white' }}
                    >
                        <Close />
                    </IconButton>
                </DialogTitle>
                <DialogContent sx={{ p: 3 }}>
                    <Typography variant="body1">
                        Dialog de detalles funcionando - Estado del dialog: {showDetailDialog ? 'Abierto' : 'Cerrado'}
                    </Typography>
                    {selectedAssignment ? (
                        <Box sx={{ mt: 2 }}>
                            <Typography variant="h6" sx={{ mb: 2 }}>
                                {selectedAssignment.title || 'Sin t√≠tulo'}
                            </Typography>
                            <Typography variant="body2" sx={{ mb: 2 }}>
                                {selectedAssignment.description || 'Sin descripci√≥n'}
                            </Typography>
                            <Typography variant="body2">
                                Estado: {selectedAssignment.status || 'Sin estado'}
                            </Typography>
                        </Box>
                    ) : (
                        <Typography color="error">
                            No hay asignaci√≥n seleccionada
                        </Typography>
                    )}
                </DialogContent>
                <DialogActions sx={{ p: 3 }}>
                    <Button
                        onClick={() => setShowDetailDialog(false)}
                        variant="contained"
                        sx={{ borderRadius: 2 }}
                    >
                        Cerrar
                    </Button>
                </DialogActions>
            </Dialog>
        </>
    );
};

export default ScheduledAssignmentsSimple;
